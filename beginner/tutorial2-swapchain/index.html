<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>The Swapchain | Learn Wgpu</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.3.1">
    
    <meta property="article:modified_time" content="2020-01-21T20:17:33.000Z"><meta property="og:site_name" content="Learn Wgpu"><meta property="og:title" content="The Swapchain"><meta property="og:type" content="website"><meta property="og:url" content="/beginner/tutorial2-swapchain/"><meta name="twitter:title" content="The Swapchain"><meta name="twitter:url" content="/beginner/tutorial2-swapchain/"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:label1" content="Written by"><meta name="twitter:data2" content="Benjamin R Hansen"><meta name="twitter:creator" content="https://twitter.com/sotrh760">
    <link rel="preload" href="/learn-wgpu/assets/css/0.styles.f819bcb6.css" as="style"><link rel="preload" href="/learn-wgpu/assets/js/app.37ce17b6.js" as="script"><link rel="preload" href="/learn-wgpu/assets/js/2.08ab0899.js" as="script"><link rel="preload" href="/learn-wgpu/assets/js/12.6b207e74.js" as="script"><link rel="preload" href="/learn-wgpu/assets/js/15.d4e54dff.js" as="script"><link rel="prefetch" href="/learn-wgpu/assets/js/10.d6298df0.js"><link rel="prefetch" href="/learn-wgpu/assets/js/11.40391db3.js"><link rel="prefetch" href="/learn-wgpu/assets/js/13.a4373cdd.js"><link rel="prefetch" href="/learn-wgpu/assets/js/14.e63e07b6.js"><link rel="prefetch" href="/learn-wgpu/assets/js/16.71fad022.js"><link rel="prefetch" href="/learn-wgpu/assets/js/17.f9d9ed22.js"><link rel="prefetch" href="/learn-wgpu/assets/js/18.34af9e75.js"><link rel="prefetch" href="/learn-wgpu/assets/js/19.d0f7c4fc.js"><link rel="prefetch" href="/learn-wgpu/assets/js/20.3e9f0e56.js"><link rel="prefetch" href="/learn-wgpu/assets/js/21.3456e76f.js"><link rel="prefetch" href="/learn-wgpu/assets/js/22.03a1d93f.js"><link rel="prefetch" href="/learn-wgpu/assets/js/23.99131bb5.js"><link rel="prefetch" href="/learn-wgpu/assets/js/3.7ed3767e.js"><link rel="prefetch" href="/learn-wgpu/assets/js/4.4de3638a.js"><link rel="prefetch" href="/learn-wgpu/assets/js/5.d05d69aa.js"><link rel="prefetch" href="/learn-wgpu/assets/js/6.9922d581.js"><link rel="prefetch" href="/learn-wgpu/assets/js/7.e56a57cf.js"><link rel="prefetch" href="/learn-wgpu/assets/js/8.cde71275.js"><link rel="prefetch" href="/learn-wgpu/assets/js/9.0dba9781.js">
    <link rel="stylesheet" href="/learn-wgpu/assets/css/0.styles.f819bcb6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="inner"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/learn-wgpu/" class="home-link router-link-active"><!----> <span class="site-name">Learn Wgpu</span></a> <div class="links"><!----> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div></div></header> <div class="sidebar-mask"></div> <div class="docs-layout"><aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/learn-wgpu/" class="sidebar-link">Introduction</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Beginner</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/learn-wgpu/beginner/tutorial1-window/" class="sidebar-link">Dependencies and the window</a></li><li><a href="/learn-wgpu/beginner/tutorial2-swapchain/" class="active sidebar-link">The Swapchain</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/learn-wgpu/beginner/tutorial2-swapchain/#first-some-house-keeping" class="sidebar-link">First, some house keeping</a></li><li class="sidebar-sub-header"><a href="/learn-wgpu/beginner/tutorial2-swapchain/#new" class="sidebar-link">new()</a></li><li class="sidebar-sub-header"><a href="/learn-wgpu/beginner/tutorial2-swapchain/#resize" class="sidebar-link">resize()</a></li><li class="sidebar-sub-header"><a href="/learn-wgpu/beginner/tutorial2-swapchain/#input" class="sidebar-link">input()</a></li><li class="sidebar-sub-header"><a href="/learn-wgpu/beginner/tutorial2-swapchain/#update" class="sidebar-link">update()</a></li><li class="sidebar-sub-header"><a href="/learn-wgpu/beginner/tutorial2-swapchain/#render" class="sidebar-link">render()</a></li><li class="sidebar-sub-header"><a href="/learn-wgpu/beginner/tutorial2-swapchain/#wait-what-s-going-on-with-renderpassdescriptor" class="sidebar-link">Wait, what's going on with RenderPassDescriptor?</a></li><li class="sidebar-sub-header"><a href="/learn-wgpu/beginner/tutorial2-swapchain/#final-thoughts" class="sidebar-link">Final thoughts</a></li><li class="sidebar-sub-header"><a href="/learn-wgpu/beginner/tutorial2-swapchain/#challenge" class="sidebar-link">Challenge</a></li></ul></li><li><a href="/learn-wgpu/beginner/tutorial3-pipeline/" class="sidebar-link">The Pipeline</a></li><li><a href="/learn-wgpu/beginner/tutorial4-buffer/" class="sidebar-link">Buffers and Indices</a></li><li><a href="/learn-wgpu/beginner/tutorial5-textures/" class="sidebar-link">Textures and bind groups</a></li><li><a href="/learn-wgpu/beginner/tutorial6-uniforms/" class="sidebar-link">Uniform buffers and a 3d camera</a></li><li><a href="/learn-wgpu/beginner/tutorial7-instancing/" class="sidebar-link">Instancing</a></li><li><a href="/learn-wgpu/beginner/tutorial8-depth/" class="sidebar-link">The Depth Buffer</a></li><li><a href="/learn-wgpu/beginner/tutorial9-models/" class="sidebar-link">Model Loading</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Intermediate</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/learn-wgpu/intermediate/tutorial10-lighting/" class="sidebar-link">Working with Lights</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Showcase</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/learn-wgpu/news/" class="sidebar-link">News</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="the-swapchain"><a href="#the-swapchain" class="header-anchor">#</a> The Swapchain</h1> <h1 id="the-swapchain-2"><a href="#the-swapchain-2" class="header-anchor">#</a> The Swapchain</h1> <h2 id="first-some-house-keeping"><a href="#first-some-house-keeping" class="header-anchor">#</a> First, some house keeping</h2> <p>For convenience we're going to pack all the fields into a struct, and create some methods on that.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token comment">// main.rs</span>
<span class="token keyword">struct</span> State <span class="token punctuation">{</span>
    surface<span class="token punctuation">:</span> wgpu<span class="token punctuation">::</span>Surface<span class="token punctuation">,</span>
    adapter<span class="token punctuation">:</span> wgpu<span class="token punctuation">::</span>Adapter<span class="token punctuation">,</span>
    device<span class="token punctuation">:</span> wgpu<span class="token punctuation">::</span>Device<span class="token punctuation">,</span>
    queue<span class="token punctuation">:</span> wgpu<span class="token punctuation">::</span>Queue<span class="token punctuation">,</span>
    sc_desc<span class="token punctuation">:</span> wgpu<span class="token punctuation">::</span>SwapChainDescriptor<span class="token punctuation">,</span>
    swap_chain<span class="token punctuation">:</span> wgpu<span class="token punctuation">::</span>SwapChain<span class="token punctuation">,</span>

    size<span class="token punctuation">:</span> winit<span class="token punctuation">::</span>dpi<span class="token punctuation">::</span>PhysicalSize<span class="token operator">&lt;</span>u32<span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> State <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function">new</span><span class="token punctuation">(</span>window<span class="token punctuation">:</span> <span class="token operator">&amp;</span>Window<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>
        <span class="token function">unimplemented!</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">fn</span> <span class="token function">resize</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> new_size<span class="token punctuation">:</span> winit<span class="token punctuation">::</span>dpi<span class="token punctuation">::</span>PhysicalSize<span class="token operator">&lt;</span>u32<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">unimplemented!</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">fn</span> <span class="token function">input</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> event<span class="token punctuation">:</span> <span class="token operator">&amp;</span>WindowEvent<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> bool <span class="token punctuation">{</span>
        <span class="token function">unimplemented!</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">fn</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">unimplemented!</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">fn</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">unimplemented!</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>I'm glossing over <code>State</code>s fields, but they'll make more sense as I explain the code behind the methods.</p> <h2 id="new"><a href="#new" class="header-anchor">#</a> new()</h2> <p>The code for this is pretty straight forward, but let's break this down a bit.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">impl</span> State <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token keyword">fn</span> <span class="token function">new</span><span class="token punctuation">(</span>window<span class="token punctuation">:</span> <span class="token operator">&amp;</span>Window<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> size <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">inner_size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">let</span> surface <span class="token operator">=</span> wgpu<span class="token punctuation">::</span>Surface<span class="token punctuation">::</span><span class="token function">create</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">let</span> adapter <span class="token operator">=</span> wgpu<span class="token punctuation">::</span>Adapter<span class="token punctuation">::</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>wgpu<span class="token punctuation">::</span>RequestAdapterOptions <span class="token punctuation">{</span>
            <span class="token punctuation">..</span>Default<span class="token punctuation">::</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The <code>surface</code> is used to create the <code>swap_chain</code>. Our <code>window</code> needs to implement <a href="https://crates.io/crates/raw-window-handle" target="_blank" rel="noopener noreferrer">raw-window-handle<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>'s <code>HasRawWindowHandle</code> trait to access the native window implementation for <code>wgpu</code> to properly create the graphics backend. Fortunately, winit's <code>Window</code> fits the bill.</p> <p>We need the <code>adapter</code> to create the device and queue.</p> <div class="language-rust extra-class"><pre class="language-rust"><code>        <span class="token keyword">let</span> <span class="token punctuation">(</span>device<span class="token punctuation">,</span> queue<span class="token punctuation">)</span> <span class="token operator">=</span> adapter<span class="token punctuation">.</span><span class="token function">request_device</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>wgpu<span class="token punctuation">::</span>DeviceDescriptor <span class="token punctuation">{</span>
            extensions<span class="token punctuation">:</span> wgpu<span class="token punctuation">::</span>Extensions <span class="token punctuation">{</span>
                anisotropic_filtering<span class="token punctuation">:</span> <span class="token keyword">false</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            limits<span class="token punctuation">:</span> Default<span class="token punctuation">::</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>As of writing, the wgpu implementation doesn't allow you to customize much of requesting a device and queue. Eventually the descriptor structs will be filled out more to allow you to find the optimal device and queue. Even so, we still need them, so we'll store them in the struct.</p> <div class="language-rust extra-class"><pre class="language-rust"><code>        <span class="token keyword">let</span> sc_desc <span class="token operator">=</span> wgpu<span class="token punctuation">::</span>SwapChainDescriptor <span class="token punctuation">{</span>
            usage<span class="token punctuation">:</span> wgpu<span class="token punctuation">::</span>TextureUsage<span class="token punctuation">::</span>OUTPUT_ATTACHMENT<span class="token punctuation">,</span>
            format<span class="token punctuation">:</span> wgpu<span class="token punctuation">::</span>TextureFormat<span class="token punctuation">::</span>Bgra8UnormSrgb<span class="token punctuation">,</span>
            width<span class="token punctuation">:</span> size<span class="token punctuation">.</span>width<span class="token punctuation">,</span>
            height<span class="token punctuation">:</span> size<span class="token punctuation">.</span>height<span class="token punctuation">,</span>
            present_mode<span class="token punctuation">:</span> wgpu<span class="token punctuation">::</span>PresentMode<span class="token punctuation">::</span>Vsync<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> swap_chain <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">create_swap_chain</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>surface<span class="token punctuation">,</span> <span class="token operator">&amp;</span>sc_desc<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Here we are defining and creating the <code>swap_chain</code>. The <code>usage</code> field describes how the <code>swap_chain</code>'s underlying textures will be used. <code>OUTPUT_ATTACHMENT</code> specifies that the textures will be used to write to the screen (we'll talk about more <code>TextureUsage</code>s later).</p> <p>The <code>format</code> defines how the <code>swap_chain</code>s textures will be stored on the gpu. Usually you want to specify the format of the display you're using. As of writing, I was unable to find a way to query what format the display has through <code>wgpu</code>, though <a href="https://github.com/gfx-rs/wgpu-rs/issues/123#issuecomment-555803321" target="_blank" rel="noopener noreferrer">there are plans on including such a method<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, so <code>wgpu::TextureFormat::Bgra8UnormSrgb</code> will do for now. We use <code>wgpu::TextureFormat::Bgra8UnormSrgb</code> because that's the format that's <a href="https://github.com/gfx-rs/wgpu-rs/issues/123#issuecomment-555800583" target="_blank" rel="noopener noreferrer">guaranteed to be natively supported by the swapchains of all the APIs/platforms<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> which are currently supported.</p> <p><code>width</code> and <code>height</code>, are self explanatory.</p> <p>There's no documentation on <code>present_mode</code> as of writing, but my guess is that it defines the rate at which you can acquire images from the <code>swap_chain</code>.</p> <p>At the end of the method, we simply return the resulting struct.</p> <div class="language-rust extra-class"><pre class="language-rust"><code>        <span class="token keyword">Self</span> <span class="token punctuation">{</span>
            surface<span class="token punctuation">,</span>
            adapter<span class="token punctuation">,</span>
            device<span class="token punctuation">,</span>
            queue<span class="token punctuation">,</span>
            sc_desc<span class="token punctuation">,</span>
            swap_chain<span class="token punctuation">,</span>
            size<span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>We'll want to call this in our main method before we enter the event loop.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">let</span> <span class="token keyword">mut</span> state <span class="token operator">=</span> State<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="resize"><a href="#resize" class="header-anchor">#</a> resize()</h2> <p>If we want to support resizing in our application, we're going to need to recreate the <code>swap_chain</code> everytime the window's size changes. That's the reason we stored the <code>hidpi_factor</code>, the logical <code>size</code>, and the <code>sc_desc</code> used to create the swapchain. With all of these, the resize method is very simple.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token comment">// impl State</span>
<span class="token keyword">fn</span> <span class="token function">resize</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> new_size<span class="token punctuation">:</span> winit<span class="token punctuation">::</span>dpi<span class="token punctuation">::</span>PhysicalSize<span class="token operator">&lt;</span>u32<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>size <span class="token operator">=</span> new_size<span class="token punctuation">;</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>sc_desc<span class="token punctuation">.</span>width <span class="token operator">=</span> new_size<span class="token punctuation">.</span>width<span class="token punctuation">;</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>sc_desc<span class="token punctuation">.</span>height <span class="token operator">=</span> new_size<span class="token punctuation">.</span>height<span class="token punctuation">;</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>swap_chain <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token function">create_swap_chain</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>surface<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>sc_desc<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>There's nothing really different here from creating the <code>swap_chain</code> initially, so I won't get into it.</p> <p>We call this method in <code>main()</code> in the event loop for the following events.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">match</span> event <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    WindowEvent<span class="token punctuation">::</span><span class="token function">Resized</span><span class="token punctuation">(</span>physical_size<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        state<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token operator">*</span>physical_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    WindowEvent<span class="token punctuation">::</span>ScaleFactorChanged <span class="token punctuation">{</span> new_inner_size<span class="token punctuation">,</span> <span class="token punctuation">..</span> <span class="token punctuation">}</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// new_inner_size is &amp;mut so w have to dereference it twice</span>
        state<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token operator">*</span>new_inner_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="input"><a href="#input" class="header-anchor">#</a> input()</h2> <p><code>input()</code> returns a <code>bool</code> to indicate whether an event has been fully processed. If the method returns <code>true</code>, the main loop won't process the event any further.</p> <p>We're just going to return false for now because we don't have any events we want to capture.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token comment">// impl State</span>
<span class="token keyword">fn</span> <span class="token function">input</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> event<span class="token punctuation">:</span> <span class="token operator">&amp;</span>WindowEvent<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> bool <span class="token punctuation">{</span>
    <span class="token keyword">false</span>
<span class="token punctuation">}</span>
</code></pre></div><p>We need to do a little more work in the event loop. We want <code>State</code> to have priority over <code>main()</code>. Doing that (and previous changes) should have your loop looking like this.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token comment">// main()</span>
event_loop<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token keyword">move</span> <span class="token closure-params"><span class="token punctuation">|</span>event<span class="token punctuation">,</span> _<span class="token punctuation">,</span> control_flow<span class="token punctuation">|</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">match</span> event <span class="token punctuation">{</span>
        Event<span class="token punctuation">::</span>WindowEvent <span class="token punctuation">{</span>
            <span class="token keyword">ref</span> event<span class="token punctuation">,</span>
            window_id<span class="token punctuation">,</span>
        <span class="token punctuation">}</span> <span class="token keyword">if</span> window_id <span class="token operator">==</span> window<span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">if</span> state<span class="token punctuation">.</span><span class="token function">input</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token operator">*</span>control_flow <span class="token operator">=</span> ControlFlow<span class="token punctuation">::</span>Wait<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> 
            <span class="token keyword">match</span> event <span class="token punctuation">{</span>
                WindowEvent<span class="token punctuation">::</span>CloseRequested <span class="token operator">=&gt;</span> <span class="token operator">*</span>control_flow <span class="token operator">=</span> ControlFlow<span class="token punctuation">::</span>Exit<span class="token punctuation">,</span>
                WindowEvent<span class="token punctuation">::</span>KeyboardInput <span class="token punctuation">{</span>
                    input<span class="token punctuation">,</span>
                    <span class="token punctuation">..</span>
                <span class="token punctuation">}</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token keyword">match</span> input <span class="token punctuation">{</span>
                        KeyboardInput <span class="token punctuation">{</span>
                            state<span class="token punctuation">:</span> ElementState<span class="token punctuation">::</span>Pressed<span class="token punctuation">,</span>
                            virtual_keycode<span class="token punctuation">:</span> <span class="token function">Some</span><span class="token punctuation">(</span>VirtualKeyCode<span class="token punctuation">::</span>Escape<span class="token punctuation">)</span><span class="token punctuation">,</span>
                            <span class="token punctuation">..</span>
                        <span class="token punctuation">}</span> <span class="token operator">=&gt;</span> <span class="token operator">*</span>control_flow <span class="token operator">=</span> ControlFlow<span class="token punctuation">::</span>Exit<span class="token punctuation">,</span>
                        _ <span class="token operator">=&gt;</span> <span class="token operator">*</span>control_flow <span class="token operator">=</span> ControlFlow<span class="token punctuation">::</span>Wait<span class="token punctuation">,</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                WindowEvent<span class="token punctuation">::</span><span class="token function">Resized</span><span class="token punctuation">(</span>physical_size<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    state<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token operator">*</span>physical_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token operator">*</span>control_flow <span class="token operator">=</span> ControlFlow<span class="token punctuation">::</span>Wait<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                WindowEvent<span class="token punctuation">::</span>ScaleFactorChanged <span class="token punctuation">{</span> new_inner_size<span class="token punctuation">,</span> <span class="token punctuation">..</span> <span class="token punctuation">}</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    state<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token operator">*</span>new_inner_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token operator">*</span>control_flow <span class="token operator">=</span> ControlFlow<span class="token punctuation">::</span>Wait<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                _ <span class="token operator">=&gt;</span> <span class="token operator">*</span>control_flow <span class="token operator">=</span> ControlFlow<span class="token punctuation">::</span>Wait<span class="token punctuation">,</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        Event<span class="token punctuation">::</span>MainEventsCleared <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            state<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            state<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token operator">*</span>control_flow <span class="token operator">=</span> ControlFlow<span class="token punctuation">::</span>Wait<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        _ <span class="token operator">=&gt;</span> <span class="token operator">*</span>control_flow <span class="token operator">=</span> ControlFlow<span class="token punctuation">::</span>Wait<span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="update"><a href="#update" class="header-anchor">#</a> update()</h2> <p>We don't have anything to update yet, so leave the method empty.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre></div><h2 id="render"><a href="#render" class="header-anchor">#</a> render()</h2> <p>Here's where the magic happens. First we need to get a frame to render to. This will include a <code>wgpu::Texture</code> and <code>wgpu::TextureView</code> that will hold the actual image we're drawing to (we'll cover this more when we talk about textures).</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token comment">// impl State</span>

<span class="token keyword">fn</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> frame <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>swap_chain<span class="token punctuation">.</span><span class="token function">get_next_texture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>We also need to create a <code>CommandEncoder</code> to create the actual commands to send to the gpu. Most modern graphics frameworks expect commands to be stored in a command buffer before being sent to the gpu. The <code>encoder</code> builds a command buffer that we can then send to the gpu.</p> <div class="language-rust extra-class"><pre class="language-rust"><code>    <span class="token keyword">let</span> <span class="token keyword">mut</span> encoder <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token function">create_command_encoder</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>wgpu<span class="token punctuation">::</span>CommandEncoderDescriptor <span class="token punctuation">{</span>
        todo<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Now we can actually get to clearing the screen (long time coming). We need to use the <code>encoder</code> to create a <code>RenderPass</code>. The <code>RenderPass</code> has all the methods to do the actual drawing. The code for creating a <code>RenderPass</code> is a bit nested, so I'll copy it all here, and talk about the pieces.</p> <div class="language-rust extra-class"><pre class="language-rust"><code>    <span class="token punctuation">{</span>
        <span class="token keyword">let</span> _render_pass <span class="token operator">=</span> encoder<span class="token punctuation">.</span><span class="token function">begin_render_pass</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>wgpu<span class="token punctuation">::</span>RenderPassDescriptor <span class="token punctuation">{</span>
            color_attachments<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span>
                wgpu<span class="token punctuation">::</span>RenderPassColorAttachmentDescriptor <span class="token punctuation">{</span>
                    attachment<span class="token punctuation">:</span> <span class="token operator">&amp;</span>frame<span class="token punctuation">.</span>view<span class="token punctuation">,</span>
                    resolve_target<span class="token punctuation">:</span> None<span class="token punctuation">,</span>
                    load_op<span class="token punctuation">:</span> wgpu<span class="token punctuation">::</span>LoadOp<span class="token punctuation">::</span>Clear<span class="token punctuation">,</span>
                    store_op<span class="token punctuation">:</span> wgpu<span class="token punctuation">::</span>StoreOp<span class="token punctuation">::</span>Store<span class="token punctuation">,</span>
                    clear_color<span class="token punctuation">:</span> wgpu<span class="token punctuation">::</span>Color <span class="token punctuation">{</span>
                        r<span class="token punctuation">:</span> <span class="token number">0.1</span><span class="token punctuation">,</span>
                        g<span class="token punctuation">:</span> <span class="token number">0.2</span><span class="token punctuation">,</span>
                        b<span class="token punctuation">:</span> <span class="token number">0.3</span><span class="token punctuation">,</span>
                        a<span class="token punctuation">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            depth_stencil_attachment<span class="token punctuation">:</span> None<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">self</span><span class="token punctuation">.</span>queue<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">[</span>
        encoder<span class="token punctuation">.</span><span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>First things first, let's talk about the <code>{}</code>. <code>encoder.begin_render_pass(...)</code> borrows <code>encoder</code> mutably (aka <code>&amp;mut self</code>). <code>encoder.finish()</code> also requires a mutable borrow. The <code>{}</code> around <code>encoder.begin_render_pass(...)</code> tells rust to drop any variables within them when the code leaves that scope thus releasing the mutable borrow on <code>encoder</code> and allowing us to <code>finish()</code> it. If you don't like the <code>{}</code>, you can also use <code>drop(render_pass)</code> to achieve the same effect.</p> <p>We can get the same results by removing the <code>{}</code>, and the <code>let _render_pass =</code> line, but we need access to the <code>_render_pass</code> in the next tutorial, so we'll leave it as is.</p> <p>The last lines of the code tell <code>wgpu</code> to finish the command buffer, and to submit it to the gpu's render queue.</p> <p>We need to update the event loop again to call this method. We'll also call update before it too.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token comment">// main()</span>
event_loop<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token keyword">move</span> <span class="token closure-params"><span class="token punctuation">|</span>event<span class="token punctuation">,</span> _<span class="token punctuation">,</span> control_flow<span class="token punctuation">|</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">match</span> event <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
        Event<span class="token punctuation">::</span>MainEventsCleared <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            state<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            state<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token operator">*</span>control_flow <span class="token operator">=</span> ControlFlow<span class="token punctuation">::</span>Wait<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>With all that, you should be getting something that looks like this.</p> <p><img src="data:image/png;base64,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IQIAANQJEQAAoE6IAAAAdUIEAACoEyIAAECdEAEAAOqECAAAUCdEAACAOiECAADUCREAAKBOiAAAAHVCBAAAqBMiAABAnRABAADqhAgAAFAnRAAAgDohAgAA1AkRAACgTogAAAB1QgQAAKgTIgAAQJ0QAQAA6oQIAABQJ0QAAIA6IQIAANQJEQAAoE6IAAAAdUIEAACoEyIAAECdEAEAAOqECAAAUCdEAACAOiECAADUCREAAKBOiAAAAHVCBAAAqBMiAABAnRABAADqhAgAAFAnRAAAgDohAgAA1AkRAACgTogAAAB1QgQAAKgTIgAAQJ0QAQAA6oQIAABQJ0QAAIA6IQIAANQJEQAAoE6IAAAAdUIEAACoEyIAAECdEAEAAOqECAAAUCdEAACAOiECAADUCREAAKBOiAAAAHVCBAAAqBMiAABAnRABAADqhAgAAFAnRAAAgDohAgAA1AkRAACgTogAAAB1QgQAAKgTIgAAQJ0QAQAA6oQIAABQJ0QAAIA6IQIAANQJEQAAoE6IAAAAdUIEAACoEyIAAECdEAEAAOqECAAAUCdEAACAOiECAADUCREAAKBOiAAAAHVCBAAAqBMiAABAnRABAADqhAgAAFAnRAAAgDohAgAA1AkRAACgTogAAAB1QgQAAKgTIgAAQJ0QAQAA6oQIAABQJ0QAAIA6IQIAANQJEQAAoE6IAAAAdUIEAACoEyIAAECdEAEAAOqECAAAUCdEAACAOiECAADUCREAAKBOiAAAAHVCBAAAqBMiAABAnRABAADqhAgAAFAnRAAAgDohAgAA1AkRAACgTogAAAB1QgQAAKgTIgAAQJ0QAQAA6oQIAABQJ0QAAIA6IQIAANQJEQAAoE6IAAAAdUIEAACoEyIAAECdEAEAAOqECAAAUCdEAACAOiECAADUCREAAKBOiAAAAHVCBAAAqBMiAABAnRABAADqhAgAAFAnRAAAgDohAgAA1AkRAACgTogAAAB1QgQAAKgTIgAAQJ0QAQAA6oQIAABQJ0QAAIA6IQIAANQJEQAAoE6IAAAAdUIEAACoEyIAAECdEAEAAOqECAAAUCdEAACAOiECAADUCREAAKBOiAAAAHVCBAAAqBMiAABAnRABAADqhAgAAFAnRAAAgDohAgAA1AkRAACgTogAAAB1QgQAAKgTIgAAQJ0QAQAA6oQIAABQJ0QAAIA6IQIAANQJEQAAoE6IAAAAdUIEAACoEyIAAECdEAEAAOqECAAAUCdEAACAOiECAADUCREAAKBOiAAAAHVCBAAAqBMiAABAnRABAADqhAgAAFAnRAAAgDohAgAA1AkRAACgTogAAAB1QgQAAKgTIgAAQJ0QAQAA6oQIAABQJ0QAAIA6IQIAANQJEQAAoE6IAAAAdUIEAACoEyIAAECdEAEAAOqECAAAUCdEAACAOiECAADUCREAAKBOiAAAAHVCBAAAqBMiAABAnRABAADqhAgAAFAnRAAAgDohAgAA1AkRAACgTogAAAB1QgQAAKgTIgAAQJ0QAQAA6oQIAABQJ0QAAIA6IQIAANQJEQAAoE6IAAAAdUIEAACoEyIAAECdEAEAAOqECAAAUCdEAACAOiECAADUCREAAKBOiAAAAHVCBAAAqBMiAABAnRABAADqhAgAAFAnRAAAgDohAgAA1AkRAACgTogAAAB1QgQAAKgTIgAAQJ0QAQAA6oQIAABQJ0QAAIA6IQIAANQJEQAAoE6IAAAAdUIEAACoEyIAAECdEAEAAOqECAAAUCdEAACAOiECAADUCREAAKBOiAAAAHVCBAAAqBMiAABAnRABAADqhAgAAFAnRAAAgDohAgAA1AkRAACgTogAAAB1QgQAAKgTIgAAQJ0QAQAA6oQIAABQJ0QAAIA6IQIAANQJEQAAoE6IAAAAdUIEAACoEyIAAECdEAEAAOqECAAAUCdEAACAOiECAADUCREAAKBOiAAAAHVCBAAAqBMiAABAnRABAADqhAgAAFAnRAAAgDohAgAA1AkRAACgTogAAAB1QgQAAKgTIgAAQJ0QAQAA6oQIAABQJ0QAAIA6IQIAANQJEQAAoE6IAAAAdUIEAACoEyIAAECdEAEAAOqECAAAUCdEAACAOiECAADUCREAAKBOiAAAAHVCBAAAqBMiAABAnRABAADqhAgAAFAnRAAAgDohAgAA1AkRAACgTogAAAB1QgQAAKgTIgAAQJ0QAQAA6oQIAABQJ0QAAIA6IQIAANQJEQAAoE6IAAAAdUIEAACoEyIAAECdEAEAAOqECAAAUCdEAACAOiECAADUCREAAKBOiAAAAHVCBAAAqBMiAABAnRABAADqhAgAAFAnRAAAgDohAgAA1AkRAACgTogAAAB1QgQAAKgTIgAAQJ0QAQAA6oQIAABQJ0QAAIA6IQIAANQJEQAAoE6IAAAAdUIEAACoEyIAAECdEAEAAOqECAAAUCdEAACAOiECAADUCREAAKBOiAAAAHVCBAAAqBMiAABAnRABAADqhAgAAFAnRAAAgDohAgAA1AkRAACgTogAAAB1QgQAAKgTIgAAQJ0QAQAA6oQIAABQJ0QAAIA6IQIAANQJEQAAoE6IAAAAdUIEAACoEyIAAECdEAEAAOqECAAAUCdEAACAOiECAADUCREAAKBOiAAAAHVCBAAAqBMiAABAnRABAADqhAgAAFAnRAAAgDohAgAA1AkRAACgTogAAAB1QgQAAKgTIgAAQJ0QAQAA6oQIAABQJ0QAAIA6IQIAANQJEQAAoE6IAAAAdUIEAACoEyIAAECdEAEAAOqECAAAUCdEAACAOiECAADUCREAAKBOiAAAAHVCBAAAqBMiAABAnRABAADqhAgAAFAnRAAAgDohAgAA1AkRAACgTogAAAB1QgQAAKgTIgAAQJ0QAQAA6oQIAABQJ0QAAIA6IQIAANQJEQAAoE6IAAAAdUIEAACoEyIAAECdEAEAAOqECAAAUCdEAACAOiECAADUCREAAKBOiAAAAHVCBAAAqBMiAABAnRABAADqhAgAAFAnRAAAgDohAgAA1AkRAACgTogAAAB1QgQAAKgTIgAAQJ0QAQAA6oQIAABQJ0QAAIA6IQIAANQJEQAAoE6IAAAAdUIEAACoEyIAAECdEAEAAOqECAAAUCdEAACAuqkk2b5udKHnAAAAfob8P4Fe1tYvSjndAAAAAElFTkSuQmCC" alt="Window with a blue background"></p> <h2 id="wait-what-s-going-on-with-renderpassdescriptor"><a href="#wait-what-s-going-on-with-renderpassdescriptor" class="header-anchor">#</a> Wait, what's going on with RenderPassDescriptor?</h2> <p>Some of you may be able to tell what's going on just by looking at it, but I'd be remiss if I didn't go over it. Let's take a look at the code again.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token operator">&amp;</span>wgpu<span class="token punctuation">::</span>RenderPassDescriptor <span class="token punctuation">{</span>
    color_attachments<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    depth_stencil_attachment<span class="token punctuation">:</span> None<span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>A <code>RenderPassDescriptor</code> only has two fields: <code>color_attachments</code> and <code>depth_stencil_attachment</code>. The <code>color_attachements</code> describe where we are going to draw our color too.</p> <p>We'll use <code>depth_stencil_attachment</code> later, but we'll set it to <code>None</code> for now.</p> <div class="language-rust extra-class"><pre class="language-rust"><code>wgpu<span class="token punctuation">::</span>RenderPassColorAttachmentDescriptor <span class="token punctuation">{</span>
    attachment<span class="token punctuation">:</span> <span class="token operator">&amp;</span>frame<span class="token punctuation">.</span>view<span class="token punctuation">,</span>
    resolve_target<span class="token punctuation">:</span> None<span class="token punctuation">,</span>
    load_op<span class="token punctuation">:</span> wgpu<span class="token punctuation">::</span>LoadOp<span class="token punctuation">::</span>Clear<span class="token punctuation">,</span>
    store_op<span class="token punctuation">:</span> wgpu<span class="token punctuation">::</span>StoreOp<span class="token punctuation">::</span>Store<span class="token punctuation">,</span>
    clear_color<span class="token punctuation">:</span> wgpu<span class="token punctuation">::</span>Color <span class="token punctuation">{</span>
        r<span class="token punctuation">:</span> <span class="token number">0.1</span><span class="token punctuation">,</span>
        g<span class="token punctuation">:</span> <span class="token number">0.2</span><span class="token punctuation">,</span>
        b<span class="token punctuation">:</span> <span class="token number">0.3</span><span class="token punctuation">,</span>
        a<span class="token punctuation">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The <code>RenderPassColorAttachmentDescriptor</code> has the <code>attachment</code> field which informs <code>wgpu</code> what texture to save the colors to. In this case we specify <code>frame.view</code> that we created using <code>swap_chain.get_next_texture()</code>. This means that any colors we draw to this attachment will get drawn to the screen.</p> <p>There's not much documentation for <code>resolve_target</code> at the moment, but it does expect an <code>Option&lt;&amp;'a TextureView&gt;</code>. Fortunately, we can use <code>None</code>.</p> <p><code>load_op</code> and <code>store_op</code> define what operation to perform when gpu looks to load and store the colors for this color attachment for this render pass. We'll get more into this when we cover render passes in depth, but for now we just <code>LoadOp::Clear</code> the texture when the render pass starts, and <code>StoreOp::Store</code> the colors when it ends.</p> <p>The last field <code>clear_color</code> is just the color to use when <code>LoadOp::Clear</code> and/or <code>StoreOp::Clear</code> are used. This is where the blue color comes from.</p> <h2 id="final-thoughts"><a href="#final-thoughts" class="header-anchor">#</a> Final thoughts</h2> <p>In the event loop we're currently using <code>*control_flow = ControlFlow::Wait</code> in multiple places. This basically means that our app will wait for new input before drawing anything. In a game, we'd want the loop to update 60 times a second or more, but since we don't need anything to move around on it's own yet we'll leave things as is for now.</p> <h2 id="challenge"><a href="#challenge" class="header-anchor">#</a> Challenge</h2> <p>Modify the <code>input()</code> method to capture mouse events, and update the clear color using that. <em>Hint: you'll probably need to use <code>WindowEvent::CursorMoved</code></em></p> <div class="auto-github-link"><a href="https://github.com/sotrh/learn-wgpu/tree/master/code/beginner/tutorial2-swapchain/" target="_blank" rel="noopener noreferrer">Check out the code!</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">1/21/2020, 1:17:33 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/learn-wgpu/beginner/tutorial1-window/" class="prev">
          Dependencies and the window
        </a></span> <span class="next"><a href="/learn-wgpu/beginner/tutorial3-pipeline/">
          The Pipeline
        </a>
        →
      </span></p></div> </main></div></div><div class="global-ui"><!----></div></div>
    <script src="/learn-wgpu/assets/js/app.37ce17b6.js" defer></script><script src="/learn-wgpu/assets/js/2.08ab0899.js" defer></script><script src="/learn-wgpu/assets/js/12.6b207e74.js" defer></script><script src="/learn-wgpu/assets/js/15.d4e54dff.js" defer></script>
  </body>
</html>
